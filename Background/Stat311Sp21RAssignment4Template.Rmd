
ASSSIGNMENT
```{r setup, include=FALSE}
library(knitr)
library(dplyr)
library(ggplot2)
library(BSDA)
source("Functions.R")
knitr::opts_chunk$set(echo = TRUE)
SHOW_SOLUTIONS = TRUE
```
EXPLORATORY DATA ANALYISIS
1.Read the ice cream, birthweight, and cholesterol data sets.

The following fucntions reads the three datasets and displays their structures through the View() function

```{r, eval=TRUE}
IC.df <- read.csv("E:/DATA SCIENCE JOBS/R-Analysis Significance Test/Background/IceCream.csv", header=TRUE, as.is=TRUE)
IC.df$Sex <- as.factor(IC.df$Sex)
IC.df$Flavor <- as.factor(IC.df$Flavor)
View(IC.df)
#
BW.df <- read.csv("E:/DATA SCIENCE JOBS/R-Analysis Significance Test/Background/BirthWeight.csv", header=TRUE, as.is=TRUE)
BW.df$Smoker <- as.factor(BW.df$Smoker)
BW.df$BirthWt <- as.factor(BW.df$BirthWt)
BW.df$MAgeGT35 <- as.factor(BW.df$MAgeGT35)
View(BW.df)
#
C.df <- read.csv("E:/DATA SCIENCE JOBS/R-Analysis Significance Test/Background/Cholesterol.csv", header=TRUE, as.is=TRUE)
View(C.df)
C.df$Cereal <- as.factor(C.df$Cereal)
```
1. Find and interpret the 92% confidence interval for the population mean puzzle score.


```{r t test for a single mean}
# Look at the t.test help file
?t.test

# First interval is 95%, which is the default if you do
# not specify conf.level
t.test(IC.df$Puzzle)$conf.int

```



2. Hypothesis test for the difference between mean puzzle scores by ice cream type. a. Create two subsets of puzzle scores, one for students that favor strawberry ice cream and one for students that favor chocolate ice cream. b. Test the claim that students with a preference for strawberry ice cream have higher puzzle scores than students that prefer chocolate ice cream. Use strawberry minus chocolate and a 1% significance level. Assume the population variances are not equal. c. Do you think the statistical test results from part (b) have practical significance? 
```{r t test for two means, independent samples}
# First get the right subset of data
D.CD <- filter(IC.df, Flavor == "1")
D.CI <- filter(IC.df, Flavor == "2")

# Look at the samples sizes and samples SDs for each group 
# to inform the decision for un-pooled or pooled variance.
n.CD <- nrow(D.CD)
sd.CD <- sd(D.CD$Puzzle)
n.CI <- nrow(D.CI)
sd.CI <- sd(D.CI$Puzzle)
cbind(nCD = n.CD, SD.CD = sd.CD, nCI = n.CI, SD.CI = sd.CI)

# The sample size for color D is smallish; the two sample
# SDs are similar. This could go either way. If we pool, 
# we will be giving a higher weight to the lower variance.
# Checking our ROT gives us a ratio < 3 (code shown below), 
# so pooling is probably okay.

sd.CD^2/sd.CI^2

# Using un-pooled would be most conservative. At the same time
# pooling may be reasonable because we might expect the
# population variances to be similar for Weight (would we expect
# the variation in Weight to be different for different colors?).

# We will run it both ways here so you can see the difference--in
# practice, you would make a choice based on your understanding
# of diamond weights and go from there.

# First interval is 1% using an un-pooled variance, both are
# defaults 
t.test(D.CD$Puzzle, D.CI$Puzzle,conf.level=0.01)$conf.int


# Same interval as above but with pooled variance
t.test(D.CD$Puzzle, D.CI$Puzzle, var.equal=TRUE)$conf.int
```



```{r Looking a df for un-pooled vs. pooled}
# Same two calls from above after removing the $conf.int at 
# the end to see all the t.test output
t.test(D.CD$Puzzle, D.CI$Puzzle,conf.level=0.01)$conf.int
t.test(D.CD$Puzzle, D.CI$Puzzle, var.equal=TRUE)

```

(b)Test the claim that students with a preference for strawberry ice cream have higher puzzle scores than students that prefer chocolate ice cream. Use strawberry minus chocolate and a 1% significance level. Assume the population variances are not equal. 


```{r}
# Test the claim that students with a preference for strawberry ice cream have higher puzzle scores than students that prefer chocolate ice cream. Use strawberry minus chocolate and a 1% significance level. Assume the population variances are not equal. 


# Enter measured, then reported as stated in the problem statement
# Add the paired=TRUE argument to let R know that the data are
# matched pairs. Set the conf.level to 0.01
t.test(IC.df$Flavor=="1",IC.df$Flavor=="3", paired=TRUE, 
       conf.level = 0.01)$conf.int
```

3. Using the oneprop.CI function in the R4 Tutorial, find the 98% confidence interval for the proportion of smokers in the birthweight data set. Assume large sample conditions are met.

```{r oneprop.CI}
# The three arguments passed to the function are
# x = number of successes, n = total number of observations
# and conf.level. We will default conf.level to 0.95.
oneprop.CI <- function(x, n, conf.level=0.95) {
  phat <- x/n
  qhat <- 1 - phat
  se.phat <- sqrt(phat*qhat/n) 
  alphaO2 <- (1 - conf.level)/2
  zcrit <- abs(qnorm(alphaO2))
  LB <- phat - (zcrit*(se.phat))
  UB <- phat + (zcrit*(se.phat))
  result <- cbind(phat = phat, Lower = LB, Upper = UB)
  return(result)
}
```
Find a 98% confidence interval for the proportion of  smokers in the BirthWeight. Before we proceed, we should check the large sample conditions: n x phat > 10 and n x qhat > 10. We use phat and qhat because p unknown. First check that the large sample conditions hold.
```{r Check conditions 1 prop}
tab1 <- table(BW.df$Smoker)
sum(tab1)*(tab1[1]/sum(tab1)) #nphat
sum(tab1)*(1-(tab1[1]/sum(tab1))) #n(1-phat) = nqhat
```


```{r Single Prop CI}
oneprop.CI(tab1[1], sum(tab1), conf.level=0.98)
```


4. Consider birthweights for mothers that are smokers and nonsmokers.   a. Create a function called twoprop.HT that uses a two-sample z test to test for the difference between two population proportions assuming independent samples.

b. Test the claim that the proportion of low birthweight babies is higher for mothers that smoked (use smoked – did not smoke). Use a 5% significance level. Assume large sample conditions are met.

c. Are the large sample conditions met for the test in (b)? Note, you can just look at the table values instead of doing any calculations. Do you think the hypothesis test results in(b) are valid? 


We will write the function twoprop.CI to get the confidence interval for a the difference between two population proportions. 


```{r twoprop.CI}
# The five arguments passed to the function are
# x1 = number of successes in sample 1, n1 = total number of observations
# in sample 1, x2 = number of successes in sample 2,
# n2 = total number of observations in sample 2, and 
# and conf.level. We will default conf.level to 0.95.
twoprop.CI <- function(x1, n1, x2, n2, conf.level=0.05) {
  phat1 <- x1/n1
  qhat1 <- 1 - phat1
  phat2<- x2/n2
  qhat2 <- 1 - phat2 
  diff.phat <- phat1 - phat2
  se.phat <- sqrt((phat1*qhat1/n1) + (phat2*qhat2/n2))
  alphaO2 <- (1 - conf.level)/2
  zcrit <- abs(qnorm(alphaO2))
  LB <- diff.phat - (zcrit*(se.phat))
  UB <- diff.phat + (zcrit*(se.phat))
  result <- cbind(diff = diff.phat, Lower = LB, Upper = UB)
  return(result)
}
```
Before we proceed, we should check the large sample conditions: n1 x phat1 > 10, n1 x qhat1 >10, n2 x phat2 > 10, n2 x qhat2 > 10. We will define sample 1 as VVS1 and sample 2 as VVS2. We will consider H colors successes and all other colors failures within VVS1 and VVS2.
```{r Check conditions 2 samples}
(tab2 <- table(BW.df$Smoker=="0", BW.df$Smoker=="1"))

sum(tab2[4]) * tab2[4,5]/sum(tab2[4,])   # n1phat1
sum(tab2[4,]) * (1- (tab2[4,5]/sum(tab2[4,])))  # n1qhat1
sum(tab2[5,]) * tab2[5,5]/sum(tab2[5,])  # n2phat2
sum(tab2[5,]) * (1- (tab2[5,5]/sum(tab2[5,])))  # n2qhat2
```
The large sample condition holds so we proceed with the confidence 5% interval.

```{r Two Prop CI}
twoprop.CI(tab2[4,5], sum(tab2[4,]), tab2[5,5], sum(tab2[5,]), conf.level=0.05) 
```


5. This problem was modified from here. A cross-over trial experiment was used to investigate whether eating oat bran lowered serum cholesterol levels. Twelve individuals were randomly assigned a diet that included either oat bran or corn flakes. After two weeks on the initial diet, serum cholesterol (mmol/L) was measured and then participants were “crossed-over” to the other diet. After two-weeks on the second diet, cholesterol levels were once again recorded. 

a. Using a 5% significance level, test the claim that a diet that includes oat bran decreases serum cholesterol. [Use Cornflk – OatBran]

We will write our own function for a HT for a single population proportion.

```{r oneprop.HT}
# The three arguments passed to the function are
# x = number of successes, n = total number of observations
# and conf.level. We will default conf.level to 0.95.
oneprop.HT <- function(x, n, pmu=0, alternative="two.sided") {
  phat <- x/n
  se.phat <- sqrt(pmu*(1-pmu)/n) 
  z.score <- (phat - pmu)/se.phat
  p.value <- 1 - pnorm(abs(z.score)) #upper tail
  if (alternative == "two.sided") p.value = 2*p.value
  result <- cbind(phat = phat, zStat = z.score, pValue = p.value)
  return(result)
}
```
Let's conduct a hypothesis test to determine if the population proportion of D colored diamonds is different than 10%, using a 1% significance level. Since this is a hypothesis test, the large enough conditions that must hold are n x p0 > 10 and n x q0 > 10. Here n = 308 and p0 = 0.10. Clearly n x p0 > 10, which means n x q0 > 10. We can continue since the large sample conditions are met. 

H0: p = 0.1 versus p != 0.1



```{r One prop HT}
(tab1 <- table(C.df$Cereal=="OatBran", C.df$Cereal=="Cornflk"))

oneprop.HT(tab1[1], sum(tab1), pmu = 0.10)
```
b. Construct an appropriate confidence interval that could be used as an equivalent to the test in part (a). [Use Cornflake – OatBran]. Explain your choice and interpret the interval. 



 6. In clinical experiments involving different groups of independent samples, it is important that the groups be similar in the important ways that affect the experiment. In an experiment designed to test the effectiveness of paroxetine for treating bipolar depression, subjects were measured using the Hamilton depression scale with the results given below (based on data from a “Double-Blind, Placebo-Controlled Comparison of Imipramine and Paroxetine in the Treatment of Bipolar Depression,” by Nemeroff et al., American Journal of Psychiatry, Vol. 158, No. 6). 
 Use a 0.05 significance level to test the claim that the treatment and placebo groups come from populations with the same mean. Assume equal population variances. [Use Treatment – Placebo]  

```


```